{% extends "base.html" %}
{% block title %}<title>NARC</title> {% endblock %}
{% load static %}

{% block scripts %}
    <script type="text/javascript" src="{% static 'js/canvasRQ.js' %}"></script>
{% endblock %}
{% block css %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/styles.css' %}">
{% endblock %}

{% block non_blur_body %}
    <div class="modal" id="canvas-url">
        <div class="modal-background no-color" id="canvas-modal-background"></div>
        <div class="modal-content" id="canvas-modal-content">
            <div class="container">
                <div class="columns is-centered is-vcentered">
                    <div class="column is-4 has-right-border has-text-right">
                        <div class="columns is-centered is-vcentered">
                            <div class="column has-text-right">
                                <img src="{% static 'images/arrow.png' %}" style="height: 50px; width: 50px">
                            </div>
                            <div class="column">
                                <p>Terms and Conditions</p>
                            </div>
                        </div>
                        <br>
                        <p>Canvas Integration</p>
                        <br>
                        <p>Account Creation</p>
                        <br>
                        <p>Other Information</p>
                    </div>
                    <div class="column">
                        <form class="form has-text-centered" onsubmit="getAPIInfo();">
                            <div class="field">
                                <div class="control">
                                    <input id="canvas-url-input" placeholder="Canvas URL" class="input">
                                </div>
                            </div>
                            <div class="field">
                                <div class="control">
                                    <button class="has-green-background has-white-text button is-medium">Go</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block body %}
    {% if error %}
        <p>{{ error }}</p>
    {% endif %}
    {% block settings_menu %} {% endblock %}
    {% block settings_menu_scripts %}{% endblock %}
    {% block home_button %}{% endblock %}
    {% block home_button_scripts %}{% endblock %}

    {% block extras %}
        <script type="text/javascript">
            $(document).ready(function() {
                $("#canvas-modal-background").on("click", (e) => {
                    e.target.parentNode.className = "modal";
                    document.getElementById("blurrable").style.filter = "none";
                });
                //
                // $(element).slideDown(1000);
                $(".animated-first").each((index, element) => {
                    $(element).slideDown(750);
                });
                $(".animated-left-to-right").each((index, element) => {
                            $(element).show("slide", {direction: "left"}, 1000);
                        });
                setTimeout( () => {
                    console.log("I'm getting here");
                    $("#animated-second").slideDown(750, () => {
                        $(".animated").each((index, element) => {
                            $(element).show("slide", {direction: "left"}, 1000);
                        });
                    });
                }, 750);
            });

            function getAPIInfo() {
                let url = document.getElementById("canvas-url-input").value;
                if (url) {
                    $.ajax({
                        url: '{% url 'canvaswrapper:oauth-url' %}',
                        method: "GET",
                        dataType: 'json',
                        data: {"url": url},
                        success: function() {
                            if (window.confirm("Would you like to allow NARC to save data?")) {
                                window.localStorage.setItem("save_data", "true");  // Stores the setting information
                                window.localStorage.setItem("autoencoder-iterations", "5000");  // Sets default
                            }
                            else {
                                window.localStorage.setItem("save_data", "false");
                                window.localStorage.setItem("autoencoder-iterations", "5000");
                            }
                            window.location.replace("{% url 'mainpages:oauth-authorization' %}");
                        },
                        error: function(results) {
                            if (results.status === 404) { // This is where a dev key cannot be found
                                alert("This deployment of Canvas is not supported!");
                            }
                            if (results.status === 406) { // This is the case where the user is already logged in
                                window.location.replace("{% url 'mainpages:courses-view' %}");
                            }
                        }
                    });
                }
                else {
                    alert("You have to provide a URL!");
                }
            }

            /**
             * This function logs a user in via Canvas' OAuth2 implementation see Main/views.py for more information
             * @returns nothing
             */
            function showURLInput() {
                document.getElementById("blurrable").style.filter = "blur(10px)";
                document.getElementById("canvas-url").className += " is-active";
                {#document.getElementById("canvas-modal-input").style.display = "none";#}
                document.getElementById("canvas-url-input").style.display = "none";
                let input = $("#canvas-url-input");
                input.show()
                input.select();
            }
        </script>
    {% endblock %}

    <section class="section" id="title-section">
        <div class="container">
            <div class="columns is-centered">
            </div>
        </div>
    </section>

    <section class="section">
        <div class="columns is-multiline is-vcentered is-centered">
            <div class="column is-2 justify-right">
                <figure class="image">
                    <a href="javascript:showURLInput();"><img class="clickable" src="{% static 'images/narc.png' %}" alt="NARC-Logo"></a>
                </figure>
            </div>
            <div class="column has-text-centered justify-left is-5">
                <h1 class="title-has-julius animated-first">NARC</h1>
                <h4 class="subtitle-has-julius" id="animated-second">An open-source cheat detection system</h4>
            </div>
            <div class="column has-text-centered is-full large-text" id="">
                <button class="has-green-background has-white-text button is-medium has-julius" id="get-started-button" onclick="showURLInput()">
                    Try it out
                </button>
            </div>
        </div>
    </section>
    <section class="section">
        <hr class="is-small is-black"/>
        <div class="columns is-multiline justify-center is-vcentered">
            <div class="column is-half has-text-centered justify-right">
                <h1 class="title-has-julius">Secure</h1>
            </div>
            <div class="column has-text-centered is-half">
                <p class="large-text">NARC is developed from the ground up to ensure that data is secure and anonymous. NARC never saves
                    data without explicit permission and all code involving data-processing is public on <a href="https://www.github.com/byrdofafeather/NARC">github</a></p>
            </div>
        </div>
        <hr class=" is-small is-black"/>
        <div class="columns is-multiline justify-center is-vcentered">
            <div class="column is-half has-text-centered justify-right">
                <h1 class="title-has-julius">Iterative Improvement</h1>
            </div>
            <div class="column has-text-centered is-half">
                <p class="large-text">At launch NARC will use a simple auto-encoder method to separate anomalies. As more people donate their
                    data, NARC will continue to get better at classifying test data. Get the <a href="">details</a></p>
            </div>
        </div>
        <hr class="is-small is-black"/>
        <div class="columns is-multiline justify-center is-vcentered">
            <div class="column is-half has-text-centered justify-right">
                <h1 class="title-has-julius">Canvas Integration</h1>
            </div>
            <div class="column has-text-centered is-half">
                <p class="large-text">NARC integrates into the Canvas platform allowing for simple back-and-forth interactions
                that powers NARC to provide in-depth analysis of testing results.</p>
            </div>
        </div>
    </section>
    {% if logged_in %}
        <p>
            It appears you have already logged in! If you want to login with a different token click the button below,
            otherwise, you can <a href="{% url 'mainpages:courses-view' %}">click me</a> to go to your homepage!</p>
    {% endif %}
{% endblock %}