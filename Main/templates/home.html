{% extends "base.html" %}
{% block title %}<title>NARC</title> {% endblock %}
{% load static %}

{% block scripts %}
    <script type="text/javascript" src="{% static 'js/canvasRQ.js' %}"></script>
{% endblock %}
{% block css %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/styles.css' %}">
{% endblock %}

{% block body %}
    {% if error %}
        <p>{{ error }}</p>
    {% endif %}
    {% block settings_menu %} {% endblock %}
    {% block settings_menu_scripts %}{% endblock %}
    {% block extras %}
        <script type="text/javascript">
            // Placeholder for actual privacy policy
            window.onload = function() {
                alert("Cookies are used on this website!");
            };

            /**
             * This function logs a user in via Canvas' OAuth2 implementation see Main/views.py for more information
             * @returns nothing
             */
            function getAPIInfo() {
                let url = window.prompt("What is your Canvas URL?", "(ex: canvas.instructure.com | stanford.instructure.com)");
                if (url) {
                    $.ajax({
                        url: '{% url 'canvaswrapper:oauth-url' %}',
                        method: "GET",
                        dataType: 'json',
                        data: {"url": url},
                        success: function() {
                            if (window.confirm("Would you like to allow NARC to save data?")) {
                                window.localStorage.setItem("save_data", "true");  // Stores the setting information
                                window.localStorage.setItem("autoencoder-iterations", "5000");  // Sets default
                            }
                            else {
                                window.localStorage.setItem("save_data", "false");
                                window.localStorage.setItem("autoencoder-iterations", "5000");
                            }
                            window.location.replace("{% url 'mainpages:oauth-authorization' %}");
                        },
                        error: function(results) {
                            if (results.status === 404) { // This is where a dev key cannot be found
                                alert("This deployment of Canvas is not supported!");
                            }
                            if (results.status === 406) { // This is the case where the user is already logged in
                                window.location.replace("{% url 'mainpages:courses-view' %}");
                            }
                        }
                    });
                }
                else {
                    alert("You have to provide a URL!");
                }
            }
        </script>

    {% endblock %}
    <div>
    <img src ="{% static 'images/login.png' %}" id="login-btn" class="button" onclick='getAPIInfo();' alt="click to login">
    <a href="{% url 'mainpages:about' %}"><img src ="{% static 'images/about.png' %}" id="about-btn" class="button" alt="click to login"></a>
    <a href="{% url 'mainpages:contact' %}"><img src ="{% static 'images/CONTACT.png' %}" id="contact-btn" class="button" alt="click to login"></a>
    </div>
    {% if logged_in %}
        <p>
            It appears you have already logged in! If you want to login with a different token click the button below,
            otherwise, you can <a href="{% url 'mainpages:courses-view' %}">click me</a> to go to your homepage!</p>
    {% endif %}
{% endblock %}