{% extends "base.html" %}
{% block title %}<title>NARC</title> {% endblock %}
{% load static %}

{% block scripts %}
    <script type="text/javascript" src="{% static 'js/canvasRQ.js' %}"></script>
{% endblock %}
{% block css %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/styles.css' %}">
{% endblock %}

{% block body %}
    {% if error %}
        <p>{{ error }}</p>
    {% endif %}
    {% block settings_menu %} {% endblock %}
    {% block settings_menu_scripts %}{% endblock %}
    {% block home_button %}{% endblock %}
    {% block home_button_scripts %}{% endblock %}

    {% block extras %}
        <script type="text/javascript">
            // Placeholder for actual privacy policy
            window.onload = function() {
                alert("Cookies are used on this website!");
            };

            /**
             * This function logs a user in via Canvas' OAuth2 implementation see Main/views.py for more information
             * @returns nothing
             */
            function getAPIInfo() {
                let url = window.prompt("What is your Canvas URL?", "(ex: canvas.instructure.com | stanford.instructure.com)");
                if (url) {
                    $.ajax({
                        url: '{% url 'canvaswrapper:oauth-url' %}',
                        method: "GET",
                        dataType: 'json',
                        data: {"url": url},
                        success: function() {
                            if (window.confirm("Would you like to allow NARC to save data?")) {
                                window.localStorage.setItem("save_data", "true");  // Stores the setting information
                                window.localStorage.setItem("autoencoder-iterations", "5000");  // Sets default
                            }
                            else {
                                window.localStorage.setItem("save_data", "false");
                                window.localStorage.setItem("autoencoder-iterations", "5000");
                            }
                            window.location.replace("{% url 'mainpages:oauth-authorization' %}");
                        },
                        error: function(results) {
                            if (results.status === 404) { // This is where a dev key cannot be found
                                alert("This deployment of Canvas is not supported!");
                            }
                            if (results.status === 406) { // This is the case where the user is already logged in
                                window.location.replace("{% url 'mainpages:courses-view' %}");
                            }
                        }
                    });
                }
                else {
                    alert("You have to provide a URL!");
                }
            }
        </script>
    {% endblock %}

    <section class="section" id="title-section">
        <div class="container">
            <div class="columns is-centered">
                <div class="column has-text-centered">
                    <h1 class="title-has-julius">NARC</h1>
                    <h4 class="subtitle-has-julius">A novel cheat detection system</h4>
                </div>
            </div>
        </div>
    </section>

    <section class="section" id="logo-section">
        <div class="container">
            <div class="columns is-centered">
                <div class="column is-one-third">
                    <figure class="image">
                        <a href="javascript:getAPIInfo();"><img class="clickable" src="{% static 'images/narc.png' %}" alt="NARC-Logo"></a>
                    </figure>
                </div>
            </div>
        </div>
    </section>
    <hr>
    <section class="section">
        <div class="container has-text-centered">
            <h1 class="title-has-julius">ABOUT</h1>
            <div class="columns is-centered">
                <div class="column large-text">
                    <p>NARC is a cheat detection system utilizing modern deep learning technologies. It's primary
                    target is Canvas LMS, but will hopefully support a variety of platforms in the future. Want to know
                        how it works, or how it keeps your data safe? Learn more<a href="{% url 'mainpages:about' %}">here</a></p>
                </div>
            </div>
        </div>
    </section>
    <hr>
    <section class="section">
        <div class="container has-text-centered">
            <h1 class="title-has-julius">LOGIN</h1>
            <div class="columns is-centered">
                <div class="column large-text">
                    <p>Ready to start trying to find cheaters?<a href="javascript:getAPIInfo();">Login</a></p>
                </div>
            </div>
        </div>
    </section>
    <hr>
    <section class="section">
        <div class="container has-text-centered">
            <h1 class="title-has-julius">CONTACT</h1>
            <div class="columns is-centered">
                <div class="column large-text">
                    <p>Still have questions? Visit us on<a href="https://www.github.com/byrdofafeather/NARC">github</a> or
                    send an<a href="{% url 'mainpages:about' %}">email</a></p>
                </div>
            </div>
        </div>
    </section>
    <hr>
    {% if logged_in %}
        <p>
            It appears you have already logged in! If you want to login with a different token click the button below,
            otherwise, you can <a href="{% url 'mainpages:courses-view' %}">click me</a> to go to your homepage!</p>
    {% endif %}
{% endblock %}